{"ast":null,"code":"import _toConsumableArray from\"/Users/jeffreynaef/.config/yarn/global/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/jeffreynaef/.config/yarn/global/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jeffreynaef/.config/yarn/global/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/jeffreynaef/.config/yarn/global/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/jeffreynaef/.config/yarn/global/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import Dashboard from\"./Dashboard\";import\"./App.css\";import ReconnectingWebSocket from\"reconnecting-websocket\";import Alert from'@material-ui/lab/Alert';import Snackbar from'@material-ui/core/Snackbar';var axios=require(\"axios\");var corsOptions={origin:\"*\"};export var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.fetchServices=function(){axios.post(\"/queryservices\",{},corsOptions).then(function(response){console.log(response.data);_this.setState({destinations:response.data});}).catch(function(error){console.log(error);});};_this.state={events:[],destinations:[],revert:false,open:false};return _this;}_createClass(App,[{key:\"handleRevert\",value:function handleRevert(e){this.setState({revert:!this.state.revert});this.setState({events:this.state.events.reverse()});}},{key:\"componentDidMount\",value:function componentDidMount(){console.log(\"Protocol: \"+window.location.protocol);var wsURL=\"ws://\"+document.location.host+\"/ws\";if(window.location.protocol===\"https:\"){wsURL=\"wss://\"+document.location.host+\"/ws\";}console.log(\"WS URL: \"+wsURL);this.fetchServices();var that=this;var sock=new ReconnectingWebSocket(wsURL);sock.onopen=function(){console.log(\"connected to \"+wsURL);//let fab = document.getElementById(\"fab\");\n//fab.setAttribute(\"sockeye-connected\", \"true\");\n};sock.onclose=function(e){console.log(\"connection closed (\"+e.code+\")\");//fab.setAttribute(\"sockeye-connected\", \"false\");\n};sock.onmessage=function(e){window.dispatchEvent(new Event(\"cloudevent\"));var t=JSON.parse(JSON.parse(e.data));// at the moment the ws sends down a double encoded thing.\nconsole.log(t);that.onCloudEvent(t);};}},{key:\"onCloudEvent\",value:function onCloudEvent(event){var data={id:event.id};Object.keys(event).forEach(function(key){if(key===\"data\"){data[key]=JSON.stringify(event[key]);return;}data[key]=event[key];});var al=_toConsumableArray(this.state.events);if(this.state.revert){if(data[\"data\"]!=null){al.push(data);this.setState({events:al.reverse()});return;}if(data[\"data\"]===undefined){this.showError();console.log(\"More information on the invalid event: \",event);return;}}if(!this.state.revert){if(data[\"data\"]!=null){al.push(data);this.setState({events:al});return;}if(data[\"data\"]===undefined){this.showError();console.log(\"More information on the invalid event: \",event);return;}}}},{key:\"showError\",value:function showError(){this.setState({open:!this.state.open});}},{key:\"render\",value:function render(){var _this2=this;var events=this.state.events;var destinations=this.state.destinations;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Dashboard,{items:events,destinations:destinations,revert:function revert(){return _this2.handleRevert();}}),/*#__PURE__*/React.createElement(Snackbar,{open:this.state.open,autoHideDuration:6000},/*#__PURE__*/React.createElement(Alert,{severity:\"error\"},\"Event received with an invalid or missing data payload. Check the console for more information\")));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/jeffreynaef/go/src/github.com/n3wscott/sockeye/frontend/src/App.js"],"names":["React","Component","Dashboard","ReconnectingWebSocket","Alert","Snackbar","axios","require","corsOptions","origin","App","props","fetchServices","post","then","response","console","log","data","setState","destinations","catch","error","state","events","revert","open","e","reverse","window","location","protocol","wsURL","document","host","that","sock","onopen","onclose","code","onmessage","dispatchEvent","Event","t","JSON","parse","onCloudEvent","event","id","Object","keys","forEach","key","stringify","al","push","undefined","showError","handleRevert"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Dashboard from \"./Dashboard\";\nimport \"./App.css\";\nimport ReconnectingWebSocket from \"reconnecting-websocket\";\nimport Alert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar';\nconst axios = require(\"axios\");\n\n\nconst corsOptions = {\n  origin: \"*\",\n};\n\nexport class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      events: [],\n      destinations: [],\n      revert: false,\n      open: false,\n    };\n  }\n\n  fetchServices = () => {\n    axios\n      .post(\"/queryservices\",{},corsOptions)\n      .then((response) => {\n        console.log(response.data);\n          this.setState({destinations:response.data});\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n    }\n  handleRevert(e) {\n    this.setState({ revert: !this.state.revert })\n    this.setState({\n      events: this.state.events.reverse()\n    });\n  }\n\n  componentDidMount() {\n    console.log(\"Protocol: \" + window.location.protocol);\n    let wsURL = \"ws://\" + document.location.host + \"/ws\";\n    if (window.location.protocol === \"https:\") {\n      wsURL = \"wss://\" + document.location.host + \"/ws\";\n    }\n\n\n    console.log(\"WS URL: \" + wsURL);\n\n    this.fetchServices();\n\n    let that = this;\n\n    let sock = new ReconnectingWebSocket(wsURL);\n    sock.onopen = function () {\n      console.log(\"connected to \" + wsURL);\n      //let fab = document.getElementById(\"fab\");\n      //fab.setAttribute(\"sockeye-connected\", \"true\");\n    };\n    sock.onclose = function (e) {\n      console.log(\"connection closed (\" + e.code + \")\");\n      //fab.setAttribute(\"sockeye-connected\", \"false\");\n    };\n    sock.onmessage = function (e) {\n      window.dispatchEvent(new Event(\"cloudevent\"));\n      let t = JSON.parse(JSON.parse(e.data)); // at the moment the ws sends down a double encoded thing.\n\n      console.log(t);\n      that.onCloudEvent(t);\n    };\n\n    \n  }\n\n  onCloudEvent(event) {\n    let data = { id: event.id };\n\n    Object.keys(event).forEach((key) => {\n      if (key === \"data\") {\n        data[key] = JSON.stringify(event[key]);\n        return;\n      }\n      data[key] = event[key];\n    });\n\n    let al = [...this.state.events];\n\n    if (this.state.revert) {\n      if (data[\"data\"] != null) {\n        al.push(data);\n        this.setState({\n          events: al.reverse()\n        });\n        return;\n      }\n      if (data[\"data\"] === undefined) {\n        this.showError();\n        console.log(\"More information on the invalid event: \", event);\n        return;\n      }\n\n    } \n    \n    if (!this.state.revert) {\n      if (data[\"data\"] != null) {\n        al.push(data);\n        this.setState({\n          events: al\n        });\n        return;\n      }\n      if (data[\"data\"] === undefined) {\n        this.showError();\n        console.log(\"More information on the invalid event: \", event);\n        return;\n      }\n\n\n    }\n  }\n\n\n    showError() {\n      this.setState({ open: !this.state.open });\n    }\n\n\n\n  render() {\n    const events = this.state.events;\n    const destinations = this.state.destinations;\n\n    return (\n      <div>\n        <Dashboard items={events} destinations={destinations}  revert={() => this.handleRevert()} />\n        <Snackbar open={this.state.open} autoHideDuration={6000} >\n          <Alert severity=\"error\">\n            Event received with an invalid or missing data payload. Check the console for more information\n          </Alert>\n        </Snackbar>\n      </div >\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}